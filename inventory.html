<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cambay:ital,wght@0,400;0,700;1,400;1,700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="lib/datatables/dataTables.css">
    <link rel="stylesheet" href="css/inventory.css">
    <title>Inventory</title>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</head>
<body>
    <nav class="navbar" id="navbar">
        <img src="resources/burger.svg" alt="">
        <p class="adminType">Test</p>
        <a href="index.html">
            <img src="resources/small-Vector.svg" alt="jais-logo">
        </a>
    </nav>

    <div class="titleInventory">
        <p class="text" id="inventoryTitle">Inventory</p>
    </div>

    <div class="wrapper">
        <div class="tableContent">
            <table id="myTable" class="display">
                <thead>
                    <tr>
                        <th>Product ID</th>
                        <th>Product Name</th>
                        <th>Category</th>
                        <th>Quantity</th>
                        <th>Price</th>
                    </tr>
                </thead>
                <tbody>
                    <!--dynamically generated from database -->
                </tbody>
            </table>
            <button class="cssbuttons-io-button">
                Add Item
                <div class="icon">
                    <svg
                      height="24"
                      width="24"
                      viewBox="0 0 24 24"
                      xmlns="http://www.w3.org/2000/svg"
                    >
                      <path d="M0 0h24v24H0z" fill="none"></path>
                      <path
                        d="M12 5v14m-7-7h14"
                        stroke="currentColor"
                        stroke-width="2"
                        fill="none"
                        stroke-linecap="round"
                      ></path>
                    </svg>
                  </div>                  
              </button>
        </div>
    </div>

    <script src="lib/jQuery/jquery-3.7.1.min.js"></script>
    <script src="lib/datatables/dataTables.js"></script>

    <script>

        document.addEventListener("DOMContentLoaded", function() {
        const adminType = new URLSearchParams(window.location.search).get('adminType');
        if (adminType) {
            const adminTypeElement = document.querySelector('.adminType');
            if (adminTypeElement) {
            adminTypeElement.textContent = adminType;
            }
        }
        });

        document.querySelector('.cssbuttons-io-button').addEventListener('click', () => {
            Swal.fire({
                title: 'Add New Item',
                html: `
                    <input type="text" id="productName" class="swal2-input" placeholder="Product Name">
                    <input type="text" id="category" class="swal2-input" placeholder="Category">
                    <input type="number" id="qty" class="swal2-input" placeholder="Quantity">
                    <input type="number" step="0.01" id="price" class="swal2-input" placeholder="Price">
                `,
                confirmButtonText: 'Submit',
                showCancelButton: true,
                preConfirm: () => {
                    const productName = document.getElementById('productName').value;
                    const category = document.getElementById('category').value;
                    const qty = document.getElementById('qty').value;
                    const price = document.getElementById('price').value;

                    if (!productName || !category || !qty || !price) {
                        Swal.showValidationMessage('Please fill in all fields');
                        return false;
                    }

                    return { productName, category, qty, price };
                }
            }).then((result) => {
                if (result.isConfirmed) {
                    const formData = new FormData();
                    formData.append('productName', result.value.productName);
                    formData.append('category', result.value.category);
                    formData.append('qty', result.value.qty);
                    formData.append('price', result.value.price);

                    fetch('add_bread.php', {
                        method: 'POST',
                        body: formData
                    })
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            Swal.fire('Success', data.message, 'success');

                            location.reload();
                        } else {
                            Swal.fire('Error', data.message, 'error');
                        }
                    })
                    .catch(error => {
                        Swal.fire('Error', 'Failed to add item.', 'error');
                        console.error(error);
                    });
                }
            });
        });


        // tabke she
        $(document).ready(function() {
            fetch('display_bread.php')
                .then(response => response.json())
                .then(data => {
                    const tableBody = document.querySelector('#myTable tbody');
                    data.forEach(product => {
                        const row = document.createElement('tr');
                        row.innerHTML = `
                            <td>${product.productId}</td>
                            <td>${product.productName}</td>
                            <td>${product.category}</td>
                            <td>${product.qty}</td>
                            <td>${product.price}</td>
                        `;
                        tableBody.appendChild(row);
                    });

                    // Re-initialize DataTable after adding rows
                    if (!$.fn.DataTable.isDataTable('#myTable')) {
                        $('#myTable').DataTable();
                    }
                })
                .catch(error => {
                    console.error('Error fetching data:', error);
                    alert('Error fetching data');
                });
        });

    </script>
</body>
</html>